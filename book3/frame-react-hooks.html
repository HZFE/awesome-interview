<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-book3/frame-react-hooks">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="search" type="application/opensearchdescription+xml" title="HZFE - å‰‘æŒ‡å‰ç«¯ Offer" href="/awesome-interview/opensearch.xml">
<link rel="preconnect" href="https://hm.baidu.com">
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c7cd0fd77ac518cc6ef46461cdc9524b";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(e,c)}()</script>
<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async data-ad-client="ca-pub-9889934432771967"></script>
<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9889934432771967" async crossorigin="anonymous"></script><title data-rh="true">React Hooks å®ç°åŸç† | HZFE - å‰‘æŒ‡å‰ç«¯ Offer</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://febook.hzfe.org/awesome-interview/book3/frame-react-hooks"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="React Hooks å®ç°åŸç† | HZFE - å‰‘æŒ‡å‰ç«¯ Offer"><meta data-rh="true" name="description" content="ç›¸å…³é—®é¢˜"><meta data-rh="true" property="og:description" content="ç›¸å…³é—®é¢˜"><link data-rh="true" rel="icon" href="/awesome-interview/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://febook.hzfe.org/awesome-interview/book3/frame-react-hooks"><link data-rh="true" rel="alternate" href="https://febook.hzfe.org/awesome-interview/book3/frame-react-hooks" hreflang="en"><link data-rh="true" rel="alternate" href="https://febook.hzfe.org/awesome-interview/book3/frame-react-hooks" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://PED5MQGL7T-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/awesome-interview/assets/css/styles.62902d4b.css">
<link rel="preload" href="/awesome-interview/assets/js/runtime~main.1799597d.js" as="script">
<link rel="preload" href="/awesome-interview/assets/js/main.df6c0c52.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_ObN2"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/awesome-interview/"><div class="navbar__logo"><img src="/awesome-interview/img/badge.svg" alt="HZFE" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/awesome-interview/img/badge.svg" alt="HZFE" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">å‰‘æŒ‡å‰ç«¯ Offer</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hzfe/awesome-interview" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD sidebarWithHideableNavbar_d0QC"><a tabindex="-1" class="sidebarLogo_YUvz" href="/awesome-interview/"><img src="/awesome-interview/img/badge.svg" alt="HZFE" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/awesome-interview/img/badge.svg" alt="HZFE" class="themedImage_W2Cr themedImage--dark_oUvU"><b>å‰‘æŒ‡å‰ç«¯ Offer</b></a><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/awesome-interview/about">å…³äºæˆ‘ä»¬</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/awesome-interview/">å‰è¨€</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/awesome-interview/book1/browser-cross-origin">æ¨¡æ‹Ÿé¢˜ä¸€</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/awesome-interview/book2/browser-render-mechanism">æ¨¡æ‹Ÿé¢˜äºŒ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/awesome-interview/book3/browser-event-loop">æ¨¡æ‹Ÿé¢˜ä¸‰</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/awesome-interview/book3/browser-event-loop">æµè§ˆå™¨ï¼šæµè§ˆå™¨äº‹ä»¶å¾ªç¯</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/awesome-interview/book3/browser-memory-leaks">æµè§ˆå™¨ï¼šå¦‚ä½•å®šä½å†…å­˜æ³„éœ²</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/awesome-interview/book3/engineer-webpack-loader">å·¥ç¨‹åŒ–ï¼šè°ˆä¸‹ webpack loader çš„æœºåˆ¶</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/awesome-interview/book3/frame-react-hooks">æ¡†æ¶ï¼šReact Hooks å®ç°åŸç†</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/awesome-interview/book3/frame-diff">æ¡†æ¶ï¼šå¸¸è§æ¡†æ¶çš„ Diff ç®—æ³•</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/awesome-interview/book3/js-async">åŸºç¡€ï¼šJavaScript å¼‚æ­¥ç¼–ç¨‹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/awesome-interview/book3/js-ts-interface-type">åŸºç¡€ï¼šTypeScript ä¸­çš„ Interface å’Œ Type Alias</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/awesome-interview/book3/css-mobile-adaptive">æ ·å¼ï¼šç§»åŠ¨ç«¯è‡ªé€‚åº”çš„å¸¸è§æ‰‹æ®µ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/awesome-interview/book3/network-http-1-2">ç½‘ç»œï¼šHTTP2 å’Œ HTTP1.1 çš„å¯¹æ¯”</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/awesome-interview/book3/coding-arr-to-tree">ç¼–ç ï¼šå°†åˆ—è¡¨è¿˜åŸä¸ºæ ‘çŠ¶ç»“æ„</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/awesome-interview/book3/algorithm-binary-tree-k">ç®—æ³•ï¼šäºŒå‰æœç´¢æ ‘çš„ç¬¬ k ä¸ªç»“ç‚¹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/awesome-interview/book3/topic-white-screen-optimization">ç»¼åˆï¼šå¦‚ä½•å‡å°‘ç™½å±çš„æ—¶é—´</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/awesome-interview/book4/browser-router">æ¨¡æ‹Ÿé¢˜å››</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_FykI"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_DTRl"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/awesome-interview/">ğŸ </a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">æ¨¡æ‹Ÿé¢˜ä¸‰</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">æ¡†æ¶ï¼šReact Hooks å®ç°åŸç†</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>React Hooks å®ç°åŸç†</h1><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ç›¸å…³é—®é¢˜">ç›¸å…³é—®é¢˜<a class="hash-link" href="#ç›¸å…³é—®é¢˜" title="Direct link to heading">â€‹</a></h2><ul><li>React Hooks æ˜¯ä»€ä¹ˆ</li><li>React Hooks æ˜¯æ€ä¹ˆå®ç°çš„</li><li>ä½¿ç”¨ React Hooks éœ€è¦æ³¨æ„ä»€ä¹ˆ</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="å›ç­”å…³é”®ç‚¹">å›ç­”å…³é”®ç‚¹<a class="hash-link" href="#å›ç­”å…³é”®ç‚¹" title="Direct link to heading">â€‹</a></h2><p><code>é—­åŒ…</code> <code>Fiber</code> <code>é“¾è¡¨</code></p><p>Hooks æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚</p><p>Hooks ä¸»è¦æ˜¯åˆ©ç”¨é—­åŒ…æ¥ä¿å­˜çŠ¶æ€ï¼Œä½¿ç”¨é“¾è¡¨ä¿å­˜ä¸€ç³»åˆ— Hooksï¼Œå°†é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ª Hook ä¸ Fiber å…³è”ã€‚åœ¨ Fiber æ ‘æ›´æ–°æ—¶ï¼Œå°±èƒ½ä» Hooks ä¸­è®¡ç®—å‡ºæœ€ç»ˆè¾“å‡ºçš„çŠ¶æ€å’Œæ‰§è¡Œç›¸å…³çš„å‰¯ä½œç”¨ã€‚</p><p>ä½¿ç”¨ Hooks çš„æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hooksã€‚</li><li>åªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨ Hooksã€‚</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="çŸ¥è¯†ç‚¹æ·±å…¥">çŸ¥è¯†ç‚¹æ·±å…¥<a class="hash-link" href="#çŸ¥è¯†ç‚¹æ·±å…¥" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="1-ç®€åŒ–å®ç°">1. ç®€åŒ–å®ç°<a class="hash-link" href="#1-ç®€åŒ–å®ç°" title="Direct link to heading">â€‹</a></h3><p><a href="https://codesandbox.io/s/hopeful-williams-id7ey?file=/src/index.js" target="_blank" rel="noopener noreferrer">React Hooks æ¨¡æ‹Ÿå®ç°</a></p><p>è¯¥ç¤ºä¾‹æ˜¯ä¸€ä¸ª React Hooks æ¥å£çš„ç®€åŒ–æ¨¡æ‹Ÿå®ç°ï¼Œå¯ä»¥å®é™…è¿è¡Œè§‚å¯Ÿã€‚å…¶ä¸­ <code>react.js</code> æ–‡ä»¶æ¨¡æ‹Ÿå®ç°äº† <code>useState</code> å’Œ <code>useEffect</code> æ¥å£ï¼Œå…¶åŸºæœ¬åŸç†å’Œ react å®é™…å®ç°ç±»ä¼¼ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="2-å¯¹æ¯”åˆ†æ">2. å¯¹æ¯”åˆ†æ<a class="hash-link" href="#2-å¯¹æ¯”åˆ†æ" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="21-çŠ¶æ€-hook">2.1 çŠ¶æ€ Hook<a class="hash-link" href="#21-çŠ¶æ€-hook" title="Direct link to heading">â€‹</a></h4><p>æ¨¡æ‹Ÿçš„ useState å®ç°ä¸­ï¼Œé€šè¿‡é—­åŒ…ï¼Œå°† state ä¿å­˜åœ¨ <code>memoizedState[cursor]</code>ã€‚ memoizedState æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥æŒ‰é¡ºåºä¿å­˜ hook å¤šæ¬¡è°ƒç”¨äº§ç”Ÿçš„çŠ¶æ€ã€‚</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> memoizedState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> cursor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">initialValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åˆæ¬¡è°ƒç”¨æ—¶ï¼Œä¼ å…¥çš„åˆå§‹å€¼ä½œä¸º stateï¼Œåç»­ä½¿ç”¨é—­åŒ…ä¸­ä¿å­˜çš„ state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> memoizedState</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cursor</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> initialValue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å¯¹æ¸¸æ ‡è¿›è¡Œé—­åŒ…ç¼“å­˜ï¼Œä½¿å¾— setState è°ƒç”¨æ—¶ï¼Œæ“ä½œæ­£ç¡®çš„å¯¹åº”çŠ¶æ€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> _cursor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cursor</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">setState</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">memoizedState</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">_cursor</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newValue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ¸¸æ ‡è‡ªå¢ï¼Œä¸ºæ¥ä¸‹æ¥è°ƒç”¨çš„ hook ä½¿ç”¨æ—¶ï¼Œå¼•ç”¨ memoizedState ä¸­çš„æ–°ä½ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cursor </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setState</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å®é™…çš„ useState å®ç°ç»è¿‡å¤šæ–¹é¢çš„<a href="https://overreacted.io/why-do-hooks-rely-on-call-order/" target="_blank" rel="noopener noreferrer">ç»¼åˆè€ƒè™‘</a>ï¼ŒReact æœ€ç»ˆé€‰æ‹©å°† Hooks è®¾è®¡ä¸ºé¡ºåºç»“æ„ï¼Œè¿™ä¹Ÿæ˜¯ Hooks ä¸èƒ½æ¡ä»¶è°ƒç”¨çš„åŸå› ã€‚</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> mountState</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">S</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">initialState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">S</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">Dispatch</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">BasicStateAction</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">S</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åˆ›å»º Hookï¼Œå¹¶å°†å½“å‰ Hook æ·»åŠ åˆ° Hooks é“¾è¡¨ä¸­</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hook </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mountWorkInProgressHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœåˆå§‹å€¼æ˜¯å‡½æ•°ï¼Œåˆ™è°ƒç”¨å‡½æ•°å–å¾—åˆå§‹å€¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> initialState </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;function&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initialState </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initialState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hook</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">memoizedState</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hook</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">baseState</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> initialState</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åˆ›å»ºä¸€ä¸ªé“¾è¡¨æ¥å­˜æ”¾æ›´æ–°å¯¹è±¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> queue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hook</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">queue</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">pending</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">dispatch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">lastRenderedReducer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> basicStateReducer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">lastRenderedState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> initialState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// dispatch ç”¨äºä¿®æ”¹çŠ¶æ€ï¼Œå¹¶å°†æ­¤æ¬¡æ›´æ–°æ·»åŠ åˆ°æ›´æ–°å¯¹è±¡é“¾è¡¨ä¸­</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">dispatch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Dispatch</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">BasicStateAction</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token constant" style="color:#36acaa">S</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dispatch</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dispatchAction</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">bind</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> currentlyRenderingFiber</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">hook</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">memoizedState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dispatch</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="21-å‰¯ä½œç”¨-hook">2.1 å‰¯ä½œç”¨ Hook<a class="hash-link" href="#21-å‰¯ä½œç”¨-hook" title="Direct link to heading">â€‹</a></h4><p>æ¨¡æ‹Ÿçš„ useEffect å®ç°ï¼ŒåŒæ ·åˆ©ç”¨äº† memoizedState é—­åŒ…æ¥å­˜å‚¨ä¾èµ–æ•°ç»„ã€‚ä¾èµ–æ•°ç»„è¿›è¡Œæµ…æ¯”è¾ƒï¼Œé»˜è®¤çš„æ¯”è¾ƒç®—æ³•æ˜¯ <code>Object.is</code>ã€‚</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">cb</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> depArray</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> oldDeps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> memoizedState</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cursor</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> hasChange </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">oldDeps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å¯¹æ¯”ä¼ å…¥çš„ä¾èµ–æ•°ç»„ä¸é—­åŒ…ä¸­ä¿å­˜çš„æ—§ä¾èµ–æ•°ç»„ï¼Œé‡‡ç”¨æµ…æ¯”è¾ƒç®—æ³•</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hasChange </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> depArray</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">some</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">dep</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">is</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dep</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> oldDeps</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hasChange</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  memoizedState</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cursor</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> depArray</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cursor</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>å®é™…çš„ useEffect å®ç°ï¼š</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mountEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">create</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">deps</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">mixed</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mountEffectImpl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">UpdateEffect</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token maybe-class-name">PassiveEffect</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// fiberFlags</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">HookPassive</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// hookFlags</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mountEffectImpl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">fiberFlags</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> hookFlags</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> create</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> deps</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åˆ›å»ºhook</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hook </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mountWorkInProgressHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> nextDeps </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> deps </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> deps</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// è®¾ç½® workInProgress çš„å‰¯ä½œç”¨æ ‡è®°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  currentlyRenderingFiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">flags</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|=</span><span class="token plain"> fiberFlags</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// fiberFlags è¢«æ ‡è®°åˆ° workInProgress</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// åˆ›å»º Effect, æŒ‚è½½åˆ° hook.memoizedState ä¸Š</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hook</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">memoizedState</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pushEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">HookHasEffect</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> hookFlags</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// hookFlags ç”¨äºåˆ›å»º effect</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nextDeps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="3-hooks-å¦‚ä½•ä¸-fiber-å…±åŒå·¥ä½œ">3. Hooks å¦‚ä½•ä¸ Fiber å…±åŒå·¥ä½œ<a class="hash-link" href="#3-hooks-å¦‚ä½•ä¸-fiber-å…±åŒå·¥ä½œ" title="Direct link to heading">â€‹</a></h3><p>åœ¨äº†è§£å¦‚ä½•å·¥ä½œä¹‹å‰ï¼Œå…ˆçœ‹çœ‹ Hook ä¸ Fiber çš„éƒ¨åˆ†ç»“æ„å®šä¹‰ï¼š</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> type </span><span class="token maybe-class-name">Hook</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">memoizedState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// æœ€æ–°çš„çŠ¶æ€å€¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">baseState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// åˆå§‹çŠ¶æ€å€¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">baseQueue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Update</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">queue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">UpdateQueue</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> any</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ç¯å½¢é“¾è¡¨ï¼Œå­˜å‚¨çš„æ˜¯è¯¥ hook å¤šæ¬¡è°ƒç”¨äº§ç”Ÿçš„æ›´æ–°å¯¹è±¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">next</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Hook</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// next æŒ‡é’ˆï¼Œä¹‹ä¸‹é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ª Hook</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> type </span><span class="token maybe-class-name">Fiber</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">updateQueue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> mixed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// å­˜å‚¨ Fiber èŠ‚ç‚¹ç›¸å…³çš„å‰¯ä½œç”¨é“¾è¡¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">memoizedState</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// å­˜å‚¨ Fiber èŠ‚ç‚¹ç›¸å…³çš„çŠ¶æ€å€¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">flags</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Flags</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// æ ‡è¯†å½“å‰ Fiber èŠ‚ç‚¹æ˜¯å¦æœ‰å‰¯ä½œç”¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ä¸ä¸ŠèŠ‚ä¸­çš„æ¨¡æ‹Ÿå®ç°ä¸åŒï¼ŒçœŸå®çš„ Hooks æ˜¯ä¸€ä¸ªå•é“¾è¡¨çš„ç»“æ„ï¼ŒReact æŒ‰ Hooks çš„æ‰§è¡Œé¡ºåºä¾æ¬¡å°† Hook èŠ‚ç‚¹æ·»åŠ åˆ°é“¾è¡¨ä¸­ã€‚ä¸‹é¢ä»¥ useState å’Œ useEffect ä¸¤ä¸ªæœ€å¸¸ç”¨çš„ hook ä¸ºä¾‹ï¼Œæ¥åˆ†æ Hooks å¦‚ä½•ä¸ Fiber å…±åŒå·¥ä½œã€‚</p><p>åœ¨æ¯ä¸ª<strong>çŠ¶æ€ Hook</strong>ï¼ˆå¦‚ useStateï¼‰èŠ‚ç‚¹ä¸­ï¼Œä¼šé€šè¿‡ queue å±æ€§ä¸Šçš„å¾ªç¯é“¾è¡¨è®°ä½æ‰€æœ‰çš„æ›´æ–°æ“ä½œï¼Œå¹¶åœ¨ update é˜¶æ®µä¾æ¬¡æ‰§è¡Œå¾ªç¯é“¾è¡¨ä¸­çš„æ‰€æœ‰æ›´æ–°æ“ä½œï¼Œæœ€ç»ˆæ‹¿åˆ°æœ€æ–°çš„ state è¿”å›ã€‚</p><p>çŠ¶æ€ Hooks ç»„æˆçš„é“¾è¡¨çš„å…·ä½“ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/4338052/130256374-80a453a4-2084-4bb8-bfba-2344f25100c4.png" alt="State Hook" class="img_E7b_"></p><p>åœ¨æ¯ä¸ª<strong>å‰¯ä½œç”¨ Hook</strong>ï¼ˆå¦‚ useEffectï¼‰èŠ‚ç‚¹ä¸­ï¼Œåˆ›å»º effect æŒ‚è½½åˆ° Hook çš„ memoizedState ä¸­ï¼Œå¹¶æ·»åŠ åˆ°ç¯å½¢é“¾è¡¨çš„æœ«å°¾ï¼Œè¯¥é“¾è¡¨ä¼šä¿å­˜åˆ° Fiber èŠ‚ç‚¹çš„ updateQueue ä¸­ï¼Œåœ¨ commit é˜¶æ®µæ‰§è¡Œã€‚</p><p>å‰¯ä½œç”¨ Hooks ç»„æˆçš„é“¾è¡¨çš„å…·ä½“ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/4338052/130258719-4a2ad7d5-3a0b-4f9c-b278-1f35a0b96843.png" alt="Effect Hook" class="img_E7b_"></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™<a class="hash-link" href="#å‚è€ƒèµ„æ–™" title="Direct link to heading">â€‹</a></h2><ol><li><a href="https://overreacted.io/why-do-hooks-rely-on-call-order/" target="_blank" rel="noopener noreferrer">Why Do React Hooks Rely on Call Order?</a></li><li><a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e" target="_blank" rel="noopener noreferrer">React hooks: not magic, just arrays</a></li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/awesome-interview/book3/engineer-webpack-loader"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">å·¥ç¨‹åŒ–ï¼šè°ˆä¸‹ webpack loader çš„æœºåˆ¶</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/awesome-interview/book3/frame-diff"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">æ¡†æ¶ï¼šå¸¸è§æ¡†æ¶çš„ Diff ç®—æ³•</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ç›¸å…³é—®é¢˜" class="table-of-contents__link toc-highlight">ç›¸å…³é—®é¢˜</a></li><li><a href="#å›ç­”å…³é”®ç‚¹" class="table-of-contents__link toc-highlight">å›ç­”å…³é”®ç‚¹</a></li><li><a href="#çŸ¥è¯†ç‚¹æ·±å…¥" class="table-of-contents__link toc-highlight">çŸ¥è¯†ç‚¹æ·±å…¥</a><ul><li><a href="#1-ç®€åŒ–å®ç°" class="table-of-contents__link toc-highlight">1. ç®€åŒ–å®ç°</a></li><li><a href="#2-å¯¹æ¯”åˆ†æ" class="table-of-contents__link toc-highlight">2. å¯¹æ¯”åˆ†æ</a><ul><li><a href="#21-çŠ¶æ€-hook" class="table-of-contents__link toc-highlight">2.1 çŠ¶æ€ Hook</a></li><li><a href="#21-å‰¯ä½œç”¨-hook" class="table-of-contents__link toc-highlight">2.1 å‰¯ä½œç”¨ Hook</a></li></ul></li><li><a href="#3-hooks-å¦‚ä½•ä¸-fiber-å…±åŒå·¥ä½œ" class="table-of-contents__link toc-highlight">3. Hooks å¦‚ä½•ä¸ Fiber å…±åŒå·¥ä½œ</a></li></ul></li><li><a href="#å‚è€ƒèµ„æ–™" class="table-of-contents__link toc-highlight">å‚è€ƒèµ„æ–™</a></li></ul></div></div></div><div class="row"><div class="col"><div class="react-utterences"><div>Loading script...</div></div></div><div class="col col--3"></div></div></div></main></div></div></div>
<script src="/awesome-interview/assets/js/runtime~main.1799597d.js"></script>
<script src="/awesome-interview/assets/js/main.df6c0c52.js"></script>
</body>
</html>